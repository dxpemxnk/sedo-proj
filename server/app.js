// ТОЧКА ВХОДА В BACKEND ПРИЛОЖЕНИЕ (Server Entry Point)
// Этот файл запускает Express сервер и настраивает его конфигурацию

// Импорт основного фреймворка Express для создания веб-сервера
const express = require('express');

// Загрузка переменных окружения из .env файла
// После выполнения этой строки все переменные из .env файла будут доступны в process.env
require("dotenv").config()

// Импорт модуля конфигурации сервера (middleware, CORS, парсеры и т.д.)
const serverConfig = require('./config/serverConfig');

// Импорт главного роутера, который объединяет все API маршруты
const indexRouter = require('./routes/index.routes');

// СОЗДАНИЕ ЭКЗЕМПЛЯРА EXPRESS ПРИЛОЖЕНИЯ
// app - это главный объект сервера, к которому подключаются middleware и роуты
const app = express();

// ОПРЕДЕЛЕНИЕ ПОРТА ДЛЯ ЗАПУСКА СЕРВЕРА
// Сервер будет слушать подключения на порту 3000
const PORT = 3000;

// ПРИМЕНЕНИЕ КОНФИГУРАЦИИ СЕРВЕРА
// Эта функция настраивает все необходимые middleware:
// - парсеры JSON и URL-encoded данных
// - CORS для разрешения запросов с фронтенда
// - логирование запросов (morgan)
// - обработка cookies
serverConfig(app)

// ПОДКЛЮЧЕНИЕ ОСНОВНОГО РОУТЕРА
// Все API запросы (начинающиеся с /) будут обрабатываться через indexRouter
// indexRouter в свою очередь распределяет запросы по специализированным роутерам:
// - /api/auth - авторизация и регистрация
// - /api/docs - работа с документами  
// - /api/cat - работа с категориями
app.use('/', indexRouter)

// ЗАПУСК СЕРВЕРА
// Сервер начинает прослушивать входящие соединения на указанном порту
// Callback функция выполняется после успешного запуска сервера
app.listen(PORT, () => console.log(`Server started at ${PORT} port`))
